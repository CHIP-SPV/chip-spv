<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CHIP-SPV: What is HIP logging for?</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CHIP-SPV<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">Multiple backend interface for HIP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">What is HIP logging for? </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >HIP provides a logging mechanism, which is a convinient way of printing important information so as to trace HIP API and runtime codes during the execution of HIP application. It assists HIP development team in the development of HIP runtime, and is useful for HIP application developers as well. Depending on the setting of logging level and logging mask, HIP logging will print different kinds of information, for different types of functionalities such as HIP APIs, executed kernels, queue commands and queue contents, etc.</p>
<h1><a class="anchor" id="autotoc_md690"></a>
HIP Logging Level:</h1>
<p >By Default, HIP logging is disabled, it can be enabled via environment setting,</p><ul>
<li>AMD_LOG_LEVEL</li>
</ul>
<p >The value of the setting controls different logging level,</p>
<div class="fragment"><div class="line">enum LogLevel {</div>
<div class="line">LOG_NONE = 0,</div>
<div class="line">LOG_ERROR = 1,</div>
<div class="line">LOG_WARNING = 2,</div>
<div class="line">LOG_INFO = 3,</div>
<div class="line">LOG_DEBUG = 4</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md691"></a>
HIP Logging Mask:</h1>
<p >Logging mask is designed to print types of functionalities during the execution of HIP application. It can be set as one of the following values,</p>
<div class="fragment"><div class="line">enum LogMask {</div>
<div class="line">  LOG_API       = 0x00000001, //!&lt; API call</div>
<div class="line">  LOG_CMD       = 0x00000002, //!&lt; Kernel and Copy Commands and Barriers</div>
<div class="line">  LOG_WAIT      = 0x00000004, //!&lt; Synchronization and waiting for commands to finish</div>
<div class="line">  LOG_AQL       = 0x00000008, //!&lt; Decode and display AQL packets</div>
<div class="line">  LOG_QUEUE     = 0x00000010, //!&lt; Queue commands and queue contents</div>
<div class="line">  LOG_SIG       = 0x00000020, //!&lt; Signal creation, allocation, pool</div>
<div class="line">  LOG_LOCK      = 0x00000040, //!&lt; Locks and thread-safety code.</div>
<div class="line">  LOG_KERN      = 0x00000080, //!&lt; kernel creations and arguments, etc.</div>
<div class="line">  LOG_COPY      = 0x00000100, //!&lt; Copy debug</div>
<div class="line">  LOG_COPY2     = 0x00000200, //!&lt; Detailed copy debug</div>
<div class="line">  LOG_RESOURCE  = 0x00000400, //!&lt; Resource allocation, performance-impacting events.</div>
<div class="line">  LOG_INIT      = 0x00000800, //!&lt; Initialization and shutdown</div>
<div class="line">  LOG_MISC      = 0x00001000, //!&lt; misc debug, not yet classified</div>
<div class="line">  LOG_AQL2      = 0x00002000, //!&lt; Show raw bytes of AQL packet</div>
<div class="line">  LOG_CODE      = 0x00004000, //!&lt; Show code creation debug</div>
<div class="line">  LOG_CMD2      = 0x00008000, //!&lt; More detailed command info, including barrier commands</div>
<div class="line">  LOG_LOCATION  = 0x00010000, //!&lt; Log message location</div>
<div class="line">  LOG_ALWAYS    = 0xFFFFFFFF, //!&lt; Log always even mask flag is zero</div>
<div class="line">};</div>
</div><!-- fragment --><p >Once AMD_LOG_LEVEL is set, logging mask is set as default with the value 0x7FFFFFFF. However, for different pupose of logging functionalities, logging mask can be defined as well via environment variable,</p>
<ul>
<li>AMD_LOG_MASK</li>
</ul>
<h1><a class="anchor" id="autotoc_md692"></a>
HIP Logging command:</h1>
<p >To pring HIP logging information, the function is defined as </p><div class="fragment"><div class="line">#define ClPrint(level, mask, format, ...)</div>
<div class="line">  do {</div>
<div class="line">    if (AMD_LOG_LEVEL &gt;= level) {</div>
<div class="line">      if (AMD_LOG_MASK &amp; mask || mask == amd::LOG_ALWAYS) {</div>
<div class="line">        if (AMD_LOG_MASK &amp; amd::LOG_LOCATION) {</div>
<div class="line">          amd::log_printf(level, __FILENAME__, __LINE__, format, ##__VA_ARGS__);</div>
<div class="line">        } else {</div>
<div class="line">          amd::log_printf(level, &quot;&quot;, 0, format, ##__VA_ARGS__);</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  } while (false)</div>
</div><!-- fragment --><p >So in HIP code, call ClPrint() function with proper input varibles as needed, for example, </p><div class="fragment"><div class="line">ClPrint(amd::LOG_INFO, amd::LOG_INIT, &quot;Initializing HSA stack.&quot;);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md693"></a>
HIP Logging Example:</h1>
<p >Below is an example to enable HIP logging and get logging information during execution of hipinfo,</p>
<div class="fragment"><div class="line">user@user-test:~/hip/bin$ export AMD_LOG_LEVEL=4</div>
<div class="line">user@user-test:~/hip/bin$ ./hipinfo</div>
<div class="line"> </div>
<div class="line">:3:rocdevice.cpp            :453 : 23647210092: Initializing HSA stack.</div>
<div class="line">:3:comgrctx.cpp             :33  : 23647639336: Loading COMGR library.</div>
<div class="line">:3:rocdevice.cpp            :203 : 23647687108: Numa select cpu agent[0]=0x13407c0(fine=0x13409a0,coarse=0x1340ad0) for gpu agent=0x1346150</div>
<div class="line">:4:runtime.cpp              :82  : 23647698669: init</div>
<div class="line">:3:hip_device_runtime.cpp   :473 : 23647698869: 5617 : [7fad295dd840] hipGetDeviceCount: Returned hipSuccess</div>
<div class="line">:3:hip_device_runtime.cpp   :502 : 23647698990: 5617 : [7fad295dd840] hipSetDevice ( 0 )</div>
<div class="line">:3:hip_device_runtime.cpp   :507 : 23647699042: 5617 : [7fad295dd840] hipSetDevice: Returned hipSuccess</div>
<div class="line">--------------------------------------------------------------------------------</div>
<div class="line">device#                           0</div>
<div class="line">:3:hip_device.cpp           :150 : 23647699276: 5617 : [7fad295dd840] hipGetDeviceProperties ( 0x7ffdbe7db730, 0 )</div>
<div class="line">:3:hip_device.cpp           :237 : 23647699335: 5617 : [7fad295dd840] hipGetDeviceProperties: Returned hipSuccess</div>
<div class="line">Name:                             Device 7341</div>
<div class="line">pciBusID:                         3</div>
<div class="line">pciDeviceID:                      0</div>
<div class="line">pciDomainID:                      0</div>
<div class="line">multiProcessorCount:              11</div>
<div class="line">maxThreadsPerMultiProcessor:      2560</div>
<div class="line">isMultiGpuBoard:                  0</div>
<div class="line">clockRate:                        1900 Mhz</div>
<div class="line">memoryClockRate:                  875 Mhz</div>
<div class="line">memoryBusWidth:                   0</div>
<div class="line">clockInstructionRate:             1000 Mhz</div>
<div class="line">totalGlobalMem:                   7.98 GB</div>
<div class="line">maxSharedMemoryPerMultiProcessor: 64.00 KB</div>
<div class="line">totalConstMem:                    8573157376</div>
<div class="line">sharedMemPerBlock:                64.00 KB</div>
<div class="line">canMapHostMemory:                 1</div>
<div class="line">regsPerBlock:                     0</div>
<div class="line">warpSize:                         32</div>
<div class="line">l2CacheSize:                      0</div>
<div class="line">computeMode:                      0</div>
<div class="line">maxThreadsPerBlock:               1024</div>
<div class="line">maxThreadsDim.x:                  1024</div>
<div class="line">maxThreadsDim.y:                  1024</div>
<div class="line">maxThreadsDim.z:                  1024</div>
<div class="line">maxGridSize.x:                    2147483647</div>
<div class="line">maxGridSize.y:                    2147483647</div>
<div class="line">maxGridSize.z:                    2147483647</div>
<div class="line">major:                            10</div>
<div class="line">minor:                            12</div>
<div class="line">concurrentKernels:                1</div>
<div class="line">cooperativeLaunch:                0</div>
<div class="line">cooperativeMultiDeviceLaunch:     0</div>
<div class="line">arch.hasGlobalInt32Atomics:       1</div>
<div class="line">arch.hasGlobalFloatAtomicExch:    1</div>
<div class="line">arch.hasSharedInt32Atomics:       1</div>
<div class="line">arch.hasSharedFloatAtomicExch:    1</div>
<div class="line">arch.hasFloatAtomicAdd:           1</div>
<div class="line">arch.hasGlobalInt64Atomics:       1</div>
<div class="line">arch.hasSharedInt64Atomics:       1</div>
<div class="line">arch.hasDoubles:                  1</div>
<div class="line">arch.hasWarpVote:                 1</div>
<div class="line">arch.hasWarpBallot:               1</div>
<div class="line">arch.hasWarpShuffle:              1</div>
<div class="line">arch.hasFunnelShift:              0</div>
<div class="line">arch.hasThreadFenceSystem:        1</div>
<div class="line">arch.hasSyncThreadsExt:           0</div>
<div class="line">arch.hasSurfaceFuncs:             0</div>
<div class="line">arch.has3dGrid:                   1</div>
<div class="line">arch.hasDynamicParallelism:       0</div>
<div class="line">gcnArch:                          1012</div>
<div class="line">isIntegrated:                     0</div>
<div class="line">maxTexture1D:                     65536</div>
<div class="line">maxTexture2D.width:               16384</div>
<div class="line">maxTexture2D.height:              16384</div>
<div class="line">maxTexture3D.width:               2048</div>
<div class="line">maxTexture3D.height:              2048</div>
<div class="line">maxTexture3D.depth:               2048</div>
<div class="line">isLargeBar:                       0</div>
<div class="line">:3:hip_device_runtime.cpp   :471 : 23647701557: 5617 : [7fad295dd840] hipGetDeviceCount ( 0x7ffdbe7db714 )</div>
<div class="line">:3:hip_device_runtime.cpp   :473 : 23647701608: 5617 : [7fad295dd840] hipGetDeviceCount: Returned hipSuccess</div>
<div class="line">:3:hip_peer.cpp             :76  : 23647701731: 5617 : [7fad295dd840] hipDeviceCanAccessPeer ( 0x7ffdbe7db728, 0, 0 )</div>
<div class="line">:3:hip_peer.cpp             :60  : 23647701784: 5617 : [7fad295dd840] canAccessPeer: Returned hipSuccess</div>
<div class="line">:3:hip_peer.cpp             :77  : 23647701831: 5617 : [7fad295dd840] hipDeviceCanAccessPeer: Returned hipSuccess</div>
<div class="line">peers:</div>
<div class="line">:3:hip_peer.cpp             :76  : 23647701921: 5617 : [7fad295dd840] hipDeviceCanAccessPeer ( 0x7ffdbe7db728, 0, 0 )</div>
<div class="line">:3:hip_peer.cpp             :60  : 23647701965: 5617 : [7fad295dd840] canAccessPeer: Returned hipSuccess</div>
<div class="line">:3:hip_peer.cpp             :77  : 23647701998: 5617 : [7fad295dd840] hipDeviceCanAccessPeer: Returned hipSuccess</div>
<div class="line">non-peers:                        device#0</div>
<div class="line"> </div>
<div class="line">:3:hip_memory.cpp           :345 : 23647702191: 5617 : [7fad295dd840] hipMemGetInfo ( 0x7ffdbe7db718, 0x7ffdbe7db720 )</div>
<div class="line">:3:hip_memory.cpp           :360 : 23647702243: 5617 : [7fad295dd840] hipMemGetInfo: Returned hipSuccess</div>
<div class="line">memInfo.total:                    7.98 GB</div>
<div class="line">memInfo.free:                     7.98 GB (100%)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md694"></a>
HIP Logging Tips:</h1>
<ul>
<li>HIP logging works for both release and debug version of HIP application.</li>
<li>Logging function with different logging level can be called in the code as needed.</li>
<li>Information with logging level less than AMD_LOG_LEVEL will be printed.</li>
<li>If need to save the HIP logging output information in a file, just define the file at the command when run the application at the terminal, for example,</li>
</ul>
<div class="fragment"><div class="line">user@user-test:~/hip/bin$ ./hipinfo &gt; ~/hip_log.txt</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
