<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CHIP-SPV: Using hipEvents to measure performance</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CHIP-SPV<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">Multiple backend interface for HIP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Using hipEvents to measure performance </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This tutorial is follow-up of the previous one where we learn how to write our first hip program, in which we compute Matrix Transpose. In this tutorial, we'll explain how to use the hipEvent to get the performance score for memory transfer and kernel execution time.</p>
<h1><a class="anchor" id="autotoc_md899"></a>
Introduction:</h1>
<p >Memory transfer and kernel execution are the most important parameter in parallel computing (specially HPC and machine learning). Memory bottlenecks is the main problem why we are not able to get the highest performance, therefore obtaining the memory transfer timing and kernel execution timing plays key role in application optimization.</p>
<h1><a class="anchor" id="autotoc_md900"></a>
Requirement:</h1>
<p >For hardware requirement and software installation <a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/INSTALL.md">Installation</a></p>
<h1><a class="anchor" id="autotoc_md901"></a>
prerequiste knowledge:</h1>
<p >Programmers familiar with CUDA, OpenCL will be able to quickly learn and start coding with the HIP API. In case you are not, don't worry. You choose to start with the best one. We'll be explaining everything assuming you are completely new to gpgpu programming.</p>
<h1><a class="anchor" id="autotoc_md902"></a>
Simple Matrix Transpose</h1>
<p >We will be using the Simple Matrix Transpose application from the previous tutorial and modify it to learn how to get the performance score for memory transfer and kernel execution time.</p>
<h1><a class="anchor" id="autotoc_md903"></a>
hipEvent_t</h1>
<p >We'll learn how to use the event management functionality of HIP runtime api. In the same sourcecode, we used for MatrixTranspose we will declare the following events as follows:</p>
<div class="fragment"><div class="line">hipEvent_t start, stop;</div>
</div><!-- fragment --><p >We'll create the event with the help of following code:</p>
<div class="fragment"><div class="line">hipEventCreate(&amp;start);</div>
<div class="line">hipEventCreate(&amp;stop);</div>
</div><!-- fragment --><p >We'll use the "eventMs" variable to store the time taken value: <code>float eventMs = 1.0f;</code></p>
<h1><a class="anchor" id="autotoc_md904"></a>
Time taken measurement by using hipEvents:</h1>
<p >We'll start the timer by calling: <code>hipEventRecord(start, NULL);</code> in this, the first parameter is the hipEvent_t, will will mark the start of the time from which the measurement has to be performed, while the second parameter has to be of the type hipStream_t. In current situation, we have passed NULL (the default stream). We will learn about the <code>hipStream_t</code> in more detail latter.</p>
<p >Now, we'll have the operation for which we need to compute the time taken. For the case of memory transfer, we'll place the <code>hipMemcpy</code>: <code>hipMemcpy(gpuMatrix, Matrix, NUM*sizeof(float), hipMemcpyHostToDevice);</code></p>
<p >and for kernel execution time we'll use <code>hipKernelLaunch</code>: </p><div class="fragment"><div class="line">hipLaunchKernelGGL(matrixTranspose,</div>
<div class="line">                   dim3(WIDTH/THREADS_PER_BLOCK_X, HEIGHT/THREADS_PER_BLOCK_Y),</div>
<div class="line">                   dim3(THREADS_PER_BLOCK_X, THREADS_PER_BLOCK_Y),</div>
<div class="line">                   0, 0,</div>
<div class="line">                   gpuTransposeMatrix , gpuMatrix, WIDTH ,HEIGHT);</div>
</div><!-- fragment --><p >Now to mark the end of the eventRecord, we will again use the hipEventRecord by passing the stop event: <code>hipEventRecord(stop, NULL);</code></p>
<p >Will synchronize the event with the help of: <code>hipEventSynchronize(stop);</code></p>
<p >In order to calculate the time taken by measuring the difference of occurance marked by the start and stop event, we'll use: <code>hipEventElapsedTime(&amp;eventMs, start, stop);</code> Here the first parameter will store the time taken value, second parameter is the starting marker for the event while the third one is marking the end.</p>
<p >We can print the value of time take comfortably since eventMs is float variable.</p>
<h1><a class="anchor" id="autotoc_md905"></a>
How to build and run:</h1>
<p >Use the make command and execute it using ./exe Use hipcc to build the application, which is using hcc on AMD and nvcc on nvidia.</p>
<h1><a class="anchor" id="autotoc_md906"></a>
More Info:</h1>
<ul>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/docs/markdown/hip_faq.md">HIP FAQ</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/docs/markdown/hip_kernel_language.md">HIP Kernel Language</a></li>
<li><a href="http://rocm-developer-tools.github.io/HIP">HIP Runtime API (Doxygen)</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/docs/markdown/hip_porting_guide.md">HIP Porting Guide</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/docs/markdown/hip_terms.md">HIP Terminology</a> (including Rosetta Stone of GPU computing terms across CUDA/HIP/HC/AMP/OpenL)</li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIPIFY/blob/master/README.md">HIPIFY</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/CONTRIBUTING.md">Developer/CONTRIBUTING Info</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/RELEASE.md">Release Notes</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
