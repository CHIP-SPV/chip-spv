<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CHIP-SPV: inline asm</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CHIP-SPV<span id="projectnumber">&#160;0.1.0</span>
   </div>
   <div id="projectbrief">Multiple backend interface for HIP</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">inline asm </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This tutorial is about how to use inline GCN asm in kernel. In this tutorial, we'll explain how to by using the simple Matrix Transpose.</p>
<h1><a class="anchor" id="autotoc_md862"></a>
Introduction:</h1>
<p >If you want to take advantage of the extra performance benefits of writing in assembly as well as take advantage of special GPU hardware features that were only available through assemby, then this tutorial is for you. In this tutorial we'll be explaining how to start writing inline asm in kernel.</p>
<p >For more insight Please read the following blogs by Ben Sander <a href="gpuopen.com/amdgcn-assembly">The Art of AMDGCN Assembly: How to Bend the Machine to Your Will</a> <a href="http://gpuopen.com/amd-gcn-assembly-cross-lane-operations/">AMD GCN Assembly: Cross-Lane Operations</a></p>
<p >For more information: <a href="http://gpuopen.com/compute-product/amd-gcn3-isa-architecture-manual/">AMD GCN3 ISA Architecture Manual</a> <a href="llvm.org/docs/AMDGPUUsage.html">User Guide for AMDGPU Back-end</a></p>
<h1><a class="anchor" id="autotoc_md863"></a>
Requirement:</h1>
<p >For hardware requirement and software installation <a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/INSTALL.md">Installation</a></p>
<h1><a class="anchor" id="autotoc_md864"></a>
prerequiste knowledge:</h1>
<p >Programmers familiar with CUDA, OpenCL will be able to quickly learn and start coding with the HIP API. In case you are not, don't worry. You choose to start with the best one. We'll be explaining everything assuming you are completely new to gpgpu programming.</p>
<h1><a class="anchor" id="autotoc_md865"></a>
Simple Matrix Transpose</h1>
<p >We will be using the Simple Matrix Transpose application from the our very first tutorial.</p>
<h1><a class="anchor" id="autotoc_md866"></a>
asm() Assembler statement</h1>
<p >In the same sourcecode, we used for MatrixTranspose. We'll add the following:</p>
<p ><code>asm volatile ("v_mov_b32_e32 %0, %1" : "=v" (out[x*width + y]) : "v" (in[y*width + x]));</code></p>
<p >GCN ISA In-line assembly, is supported. For example:</p>
<div class="fragment"><div class="line">asm volatile (&quot;v_mac_f32_e32 %0, %2, %3&quot; : &quot;=v&quot; (out[i]) : &quot;0&quot;(out[i]), &quot;v&quot; (a), &quot;v&quot; (in[i]));</div>
</div><!-- fragment --><p >We insert the GCN isa into the kernel using <code>asm()</code> Assembler statement. <code>volatile</code> keyword is used so that the optimizers must not change the number of volatile operations or change their order of execution relative to other volatile operations. <code>v_mac_f32_e32</code> is the GCN instruction, for more information please refer - <a href="http://gpuopen.com/compute-product/amd-gcn3-isa-architecture-manual/">AMD GCN3 ISA architecture manual</a> Index for the respective operand in the ordered fashion is provided by <code>%</code> followed by position in the list of operands <code>"v"</code> is the constraint code (for target-specific AMDGPU) for 32-bit VGPR register, for more info please refer - <a href="https://llvm.org/docs/LangRef.html#supported-constraint-code-list">Supported Constraint Code List for AMDGPU</a> Output Constraints are specified by an <code>"="</code> prefix as shown above ("=v"). This indicate that assemby will write to this operand, and the operand will then be made available as a return value of the asm expression. Input constraints do not have a prefix - just the constraint code. The constraint string of <code>"0"</code> says to use the assigned register for output as an input as well (it being the 0'th constraint).</p>
<h1><a class="anchor" id="autotoc_md867"></a>
How to build and run:</h1>
<p >Use the make command and execute it using ./exe Use hipcc to build the application, which is using hcc on AMD and nvcc on nvidia.</p>
<h1><a class="anchor" id="autotoc_md868"></a>
More Info:</h1>
<ul>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/docs/markdown/hip_faq.md">HIP FAQ</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/docs/markdown/hip_kernel_language.md">HIP Kernel Language</a></li>
<li><a href="http://rocm-developer-tools.github.io/HIP">HIP Runtime API (Doxygen)</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/docs/markdown/hip_porting_guide.md">HIP Porting Guide</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/docs/markdown/hip_terms.md">HIP Terminology</a> (including Rosetta Stone of GPU computing terms across CUDA/HIP/HC/AMP/OpenL)</li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIPIFY/blob/master/README.md">HIPIFY</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/CONTRIBUTING.md">Developer/CONTRIBUTING Info</a></li>
<li><a href="https://github.com/ROCm-Developer-Tools/HIP/blob/master/RELEASE.md">Release Notes</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
